<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>部屋102</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style_base.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.3/socket.io.js"></script>
    <audio id="notificationSound" preload="auto">
        <source src="{{ url_for('static', filename='notification.mp3') }}" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
</head>
<body>

    <header>
        <h1>部屋102</h1>
    </header>

    <main>
        <div class="center-box">
            <div>
                <h1>XXXホテル</h1>
            </div>
            <div class="center-box-mes">
                <h2 id="display">{{ message }}</h2>
            </div>
            <div class="center-box-progress">
                <progress id="countdown" value="100" max="100"></progress>
            </div>
            <form name="form01" action="/" method="post" class="center-box-button">
                <table>
                    <tr>
                        <td colspan="2">
                            <button type="submit" name="choice" value="Y">はい</button>
                            <button type="submit" name="choice" value="N">いいえ</button>
                        </td>
                    </tr>
                </table>
            </form>
        </div>


        <script>
            var socket = io.connect('http://' + document.domain + ':' + location.port);
            var notificationSound = document.getElementById('notificationSound');
            socket.on('room102', function (message) {
                document.getElementById('display').innerHTML = message;

                notificationSound.play();
        
                // 设置一个30秒的定时器（根据需要进行调整）
                var countdownValue = 10;
                var countdownElement = document.getElementById('countdown');
                countdownElement.value = 100;
        
                var countdownInterval = setInterval(function () {
                    countdownElement.value = (countdownValue / 10) * 100; // 根据计时器值进行调整
                    countdownValue--;
        
                    if (countdownValue < 0) {
                        // 时间用尽，自动提交带有 choice='N' 的表单
                        document.forms['form01'].elements['choice'].value = 'N';
                        document.forms['form01'].submit();
                        clearInterval(countdownInterval); // 停止倒计时
                    }
                }, 1000); // 每秒更新一次倒计时
            });
        </script>
    </main>

    <footer>
        <p>&copy; 2023 房间</p>
    </footer>

</body>
</html>
